<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta
      name="description"
      content="Interactive 3D Heart Animation with Three.js - Explore a beautiful beating heart with particle effects and smooth animations"
    />
    <meta
      name="keywords"
      content="3D, animation, heart, three.js, webgl, interactive, particles, visualization"
    />
    <meta name="author" content="3D Heart Animation" />
    <meta name="theme-color" content="#ff77fc" />
    <meta name="color-scheme" content="dark" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="3D Heart Animation" />
    <meta
      property="og:description"
      content="Interactive 3D Heart Animation with Three.js"
    />
    <meta
      property="og:image"
      content="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ù§Ô∏è</text></svg>"
    />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content="3D Heart Animation" />
    <meta
      property="twitter:description"
      content="Interactive 3D Heart Animation with Three.js"
    />

    <!-- Performance optimizations -->
    <link rel="preconnect" href="https://assets.codepen.io" crossorigin />
    <link rel="dns-prefetch" href="https://assets.codepen.io" />

    <!-- Resource hints -->
    <link rel="preload" href="assets/css/style.css" as="style" />
    <link rel="preload" href="assets/js/three.min.js" as="script" />
    <link rel="preload" href="assets/js/main.js" as="script" />
    <link
      rel="preload"
      href="assets/music/she-says.mp3"
      as="fetch"
      crossorigin
    />

    <!-- Favicon and app icons -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ù§Ô∏è</text></svg>"
    />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ù§Ô∏è</text></svg>"
    />

    <!-- PWA manifest -->
    <link
      rel="manifest"
      href='data:application/json,{"name":"3D Heart Animation","short_name":"Heart","theme_color":"#ff77fc","background_color":"#000000","display":"fullscreen"}'
    />

    <title>3D Heart Animation - Interactive Three.js Experience</title>

    <!-- Critical CSS -->
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link" aria-label="Skip to main content"
      >Skip to main content</a
    >

    <!-- Loading indicator with enhanced accessibility -->
    <div
      id="loading"
      role="status"
      aria-live="polite"
      aria-label="Loading 3D Heart Animation"
    >
      <div class="loading-container">
        <div
          class="loading-spinner"
          aria-hidden="true"
          role="presentation"
        ></div>
        <div class="loading-text" id="loading-text">
          Loading 3D Heart Animation...
        </div>
        <div class="loading-progress" aria-hidden="true">
          <div class="progress-bar" id="progress-bar"></div>
        </div>
      </div>
    </div>

    <!-- Keyboard controls guide -->
    <div
      id="music-controls"
      class="music-controls"
      role="region"
      aria-label="Controls Guide"
      tabindex="0"
    >
      <div
        class="controls-header"
        style="margin-bottom: 8px; font-weight: bold"
      >
        üéÆ Controls
      </div>

      <!-- Camera Controls -->
      <div class="control-section">
        <div class="section-title">üì∑ Camera</div>
        <div class="control-item">‚Üë‚Üì‚Üê‚Üí - Move</div>
      </div>

      <!-- Animation Controls -->
      <div class="control-section">
        <div class="section-title">üé¨ Animation</div>
        <div class="control-item">Space - Pause/Play</div>
      </div>

      <!-- Music Controls -->
      <div class="control-section">
        <div class="section-title">üéµ Music</div>
        <div class="control-item">M - Play/Pause;</div>
        <div class="control-item">R - Restart;</div>
        <div class="control-item">+/- - Volume;</div>
        <div class="control-item">L - Loop</div>
      </div>

      <!-- Mouse/Touch Controls -->
      <div class="control-section">
        <div class="section-title">üñ±Ô∏è Mouse</div>
        <div class="control-item" style="cursor: default">Drag - Rotate;</div>
        <div class="control-item" style="cursor: default">Scroll - Zoom</div>
      </div>

      <!-- Interface Controls -->
      <div class="control-section">
        <div class="section-title">‚öôÔ∏è UI</div>
        <div class="control-item">H - Hide/Show</div>
      </div>

      <div class="auto-replay">üîÑ Auto-replay on</div>
      <div class="hide-tip">Click or H to hide</div>
    </div>

    <!-- Error display for better user feedback -->
    <div
      id="error-display"
      class="error-display"
      role="alert"
      aria-live="assertive"
      hidden
    >
      <div class="error-content">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-message" id="error-message"></div>
        <button class="error-retry" id="error-retry" aria-label="Retry loading">
          Retry
        </button>
      </div>
    </div>

    <!-- No JavaScript warning -->
    <noscript>
      <div class="noscript-warning" role="alert">
        <div class="noscript-content">
          <h1>JavaScript Required</h1>
          <p>
            This site requires JavaScript to display the 3D animation. Please
            enable JavaScript in your browser settings.
          </p>
          <p>
            For the best experience, use a modern browser with WebGL support.
          </p>
        </div>
      </div>
    </noscript>

    <!-- Main content area -->
    <main
      id="main-content"
      tabindex="-1"
      role="main"
      aria-label="3D Heart Animation Canvas"
    >
      <!-- Canvas will be inserted here by JavaScript -->
    </main>

    <!-- Performance monitoring -->
    <script>
      // Performance monitoring
      window.addEventListener("load", function () {
        if ("performance" in window) {
          const perfData = performance.getEntriesByType("navigation")[0];
          console.log(
            "Page load time:",
            perfData.loadEventEnd - perfData.loadEventStart,
            "ms"
          );
        }
      });

      // Error tracking
      window.addEventListener("error", function (e) {
        console.error("Global error:", e.error);
        const errorDisplay = document.getElementById("error-display");
        const errorMessage = document.getElementById("error-message");
        if (errorDisplay && errorMessage) {
          errorMessage.textContent =
            "An error occurred. Please refresh the page.";
          errorDisplay.hidden = false;
        }
      });
    </script>

    <!-- Scripts with proper loading order and error handling -->
    <script
      src="assets/js/three.min.js"
      onerror="handleScriptError('Three.js')"
    ></script>
    <script
      src="assets/js/mesh-surface-sampler.js"
      defer
      onerror="handleScriptError('Mesh Surface Sampler')"
    ></script>
    <script
      src="assets/js/trackball-controls.js"
      defer
      onerror="handleScriptError('Trackball Controls')"
    ></script>
    <script
      src="assets/js/simplex-noise.js"
      defer
      onerror="handleScriptError('Simplex Noise')"
    ></script>
    <script
      src="assets/js/obj-loader.js"
      defer
      onerror="handleScriptError('OBJ Loader')"
    ></script>
    <script
      src="assets/js/gsap.min.js"
      defer
      onerror="handleScriptError('GSAP')"
    ></script>
    <script
      src="assets/js/main.js"
      defer
      onerror="handleScriptError('Main Application')"
    ></script>

    <script>
      // Script error handling
      function handleScriptError(scriptName) {
        console.error("Failed to load:", scriptName);
        const errorDisplay = document.getElementById("error-display");
        const errorMessage = document.getElementById("error-message");
        if (errorDisplay && errorMessage) {
          errorMessage.textContent = `Failed to load ${scriptName}. Please check your internet connection and refresh the page.`;
          errorDisplay.hidden = false;
        }
      }

      // Retry functionality
      document
        .getElementById("error-retry")
        ?.addEventListener("click", function () {
          window.location.reload();
        });
    </script>
  </body>
</html>
